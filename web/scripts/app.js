const API_URL="http://localhost:3001/api";const APP_DATA={documents:[{id:"ml",name:"Machine Learning.pdf",type:"PDF",topic:"machine_learning",size:"2.4MB",icon:"ü§ñ"},{id:"web",name:"Web Development.docx",type:"DOCX",topic:"web_development",size:"1.8MB",icon:"üåê"},{id:"data",name:"Data Science.pdf",type:"PDF",topic:"data_science",size:"3.1MB",icon:"üìä"}],questions:{machine_learning:[{question:"What is supervised learning?",options:["Unlabeled","Learn from labeled data","Reduce complexity","Visualize"],correct:1,explanation:"Supervised learning uses labeled training data."},{question:"Best classification?",options:["K-means","PCA","Random Forest","Linear"],correct:2,explanation:"Random Forest combines decision trees."},{question:"What is overfitting?",options:["Too data","Good train, bad new","Resources","Features"],correct:1,explanation:"Model memorizes training data."},{question:"Cross-validation?",options:["Size","Evaluate unseen","Speed","Memory"],correct:1,explanation:"Evaluates on unseen data."},{question:"Imbalanced metric?",options:["Accuracy","F1-score","MSE","R2"],correct:1,explanation:"F1-score balances precision/recall."},{question:"Ensemble?",options:["Single","Multiple","Sequential","Deep"],correct:1,explanation:"Combines multiple models."},{question:"Bias-variance?",options:["Speed","Underfit/overfit","Train/test","Supervised"],correct:1,explanation:"Balances model complexity."},{question:"Prevent overfit?",options:["Add","Complex","Regularization","Data"],correct:2,explanation:"Regularization constrains model."},{question:"Supervised vs unsupervised?",options:["Labeled/unlabeled","Faster","More data","None"],correct:0,explanation:"Supervised uses labeled data."},{question:"ReLU activation?",options:["Sigmoid","Linear","ReLU","Step"],correct:2,explanation:"ReLU prevents vanishing gradients."}],web_development:[{question:"HTML means?",options:["High Tech","HyperText Markup","Home Tool","Hyperlink"],correct:1,explanation:"Standard markup language."},{question:"CSS color?",options:["font-color","text-color","color","background"],correct:2,explanation:"color property sets text."},{question:"JavaScript?",options:["Style","Structure","Interactivity","Databases"],correct:2,explanation:"Client-side scripting."},{question:"HTTP retrieve?",options:["POST","GET","PUT","DELETE"],correct:1,explanation:"GET retrieves data."},{question:"CSS stands?",options:["Computer","Creative","Cascading Style Sheets","Colorful"],correct:2,explanation:"Styling markup language."}],data_science:[{question:"Preprocessing?",options:["Size","Clean data","Visualize","Deploy"],correct:1,explanation:"Cleans raw data."},{question:"Python?",options:["NumPy","Pandas","Matplotlib","Scikit"],correct:1,explanation:"Data manipulation."},{question:"EDA?",options:["Electronic","Exploratory Data Analysis","Extended","Experimental"],correct:1,explanation:"Analyzes datasets."},{question:"Correlation?",options:["Bar","Pie","Scatter","Histogram"],correct:2,explanation:"Shows relationships."},{question:"Feature eng?",options:["Reduce","Improve","Visualize","Clean"],correct:1,explanation:"Creates better features."}]}},state={currentStep:"upload",selectedDocument:null,questionCount:5,difficulty:"medium",quizQuestions:[],currentQuestionIndex:0,answers:[],startTime:null,timerInterval:null,score:null};function renderSamples(){const html=APP_DATA.documents.map(d=>`<div class="sample-card" onclick="selectDocument('${d.id}')"><div class="icon">${d.icon}</div><h3>${d.name}</h3><p>${d.type} ‚Ä¢ ${d.size}</p></div>`).join("");document.getElementById("samples").innerHTML=html}function setupFileUpload(){const drop=document.getElementById("upload-area"),input=document.getElementById("file-input");if(!drop||!input)return;const onFiles=files=>{if(!files?.length)return;const file=files[0];if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(file.type)&&!/\.(pdf|docx)$/i.test(file.name))return void alert("Only PDF/DOCX");if(file.size>5e7)return void alert("Max 50MB");state.selectedDocument={id:"uploaded",name:file.name,type:file.type.includes("pdf")?"PDF":"DOCX",topic:detectTopic(file.name),size:`${(file.size/1024/1024).toFixed(2)}MB`,icon:"üìÑ"},document.getElementById("doc-info").innerHTML=`<h4>‚úÖ Uploaded</h4><p>${state.selectedDocument.name}</p>`,showSection("configure-section"),updateStep("configure")};input.addEventListener("change",e=>onFiles(e.target.files)),["dragenter","dragover"].forEach(evt=>drop.addEventListener(evt,e=>{e.preventDefault(),drop.classList.add("drag-over")})),["dragleave","drop"].forEach(evt=>drop.addEventListener(evt,e=>{e.preventDefault(),drop.classList.remove("drag-over")})),drop.addEventListener("drop",e=>onFiles(e.dataTransfer.files))}function detectTopic(name){const s=name.toLowerCase();return/ml|machine|learning/.test(s)?"machine_learning":/web|html|css/.test(s)?"web_development":/data|science/.test(s)?"data_science":"machine_learning"}function selectDocument(id){const doc=APP_DATA.documents.find(d=>d.id===id);doc&&(state.selectedDocument=doc,document.getElementById("doc-info").innerHTML=`<h4>‚úÖ Selected</h4><p>${doc.name}</p>`,showSection("configure-section"),updateStep("configure"))}function setupEventListeners(){document.querySelectorAll("#count-buttons .btn-opt").forEach(btn=>btn.addEventListener("click",()=>{document.querySelectorAll("#count-buttons .btn-opt").forEach(b=>b.classList.remove("active")),btn.classList.add("active"),state.questionCount=parseInt(btn.dataset.count)})),document.querySelectorAll("#difficulty-buttons .btn-opt").forEach(btn=>btn.addEventListener("click",()=>{document.querySelectorAll("#difficulty-buttons .btn-opt").forEach(b=>b.classList.remove("active")),btn.classList.add("active"),state.difficulty=btn.dataset.difficulty})),document.getElementById("generate-btn").addEventListener("click",generateQuiz),document.getElementById("prev-btn").addEventListener("click",prevQuestion),document.getElementById("next-btn").addEventListener("click",nextQuestion),document.getElementById("finish-btn").addEventListener("click",finishQuiz),document.getElementById("download-btn").addEventListener("click",downloadResults),document.getElementById("certificate-btn").addEventListener("click",downloadCertificate),document.getElementById("new-quiz-btn").addEventListener("click",resetQuiz)}function generateQuiz(){if(!state.selectedDocument)return;let questions=APP_DATA.questions[state.selectedDocument.topic]||APP_DATA.questions.machine_learning;state.quizQuestions=questions.slice(0,state.questionCount),state.answers=new Array(state.quizQuestions.length).fill(null),state.currentQuestionIndex=0,state.startTime=Date.now(),startTimer(),showSection("quiz-section"),updateStep("quiz"),renderQuestion(),updateProgress()}function startTimer(){state.timerInterval&&clearInterval(state.timerInterval),state.timerInterval=setInterval(()=>{const elapsed=Math.floor((Date.now()-state.startTime)/1e3),m=Math.floor(elapsed/60),s=elapsed%60;document.getElementById("timer").textContent=`‚è±Ô∏è ${m}:${s.toString().padStart(2,"0")}`},1e3)}function renderQuestion(){const q=state.quizQuestions[state.currentQuestionIndex],saved=state.answers[state.currentQuestionIndex];document.getElementById("quiz-content").innerHTML=`<div class="quiz-question"><h3>Q${state.currentQuestionIndex+1}: ${q.question}</h3><div class="quiz-options">${q.options.map((opt,idx)=>`<div class="quiz-option ${saved===idx?"selected":""}" onclick="selectAnswer(${idx})">${String.fromCharCode(65+idx)}. ${opt}</div>`).join("")}</div></div>`,updateNav()}function selectAnswer(idx){state.answers[state.currentQuestionIndex]=idx,document.querySelectorAll(".quiz-option").forEach((el,i)=>{i===idx?el.classList.add("selected"):el.classList.remove("selected")})}function updateNav(){const isFirst=0===state.currentQuestionIndex,isLast=state.currentQuestionIndex===state.quizQuestions.length-1;isFirst?document.getElementById("prev-btn").classList.add("hidden"):document.getElementById("prev-btn").classList.remove("hidden"),isLast?(document.getElementById("next-btn").classList.add("hidden"),document.getElementById("finish-btn").classList.remove("hidden")):(document.getElementById("next-btn").classList.remove("hidden"),document.getElementById("finish-btn").classList.add("hidden"))}function updateProgress(){const curr=state.currentQuestionIndex+1,total=state.quizQuestions.length,pct=Math.round(curr/total*100);document.getElementById("question-num").textContent=`Q ${curr} of ${total}`,document.getElementById("progress-pct").textContent=`${pct}%`,document.getElementById("progress-fill").style.width=`${pct}%`}function prevQuestion(){state.currentQuestionIndex>0&&(state.currentQuestionIndex--,renderQuestion(),updateProgress())}function nextQuestion(){state.currentQuestionIndex<state.quizQuestions.length-1&&(state.currentQuestionIndex++,renderQuestion(),updateProgress())}function finishQuiz(){clearInterval(state.timerInterval);let correct=0;const results=[];state.quizQuestions.forEach((q,i)=>{const ans=state.answers[i],ok=ans===q.correct;ok&&correct++,results.push({question:q.question,options:q.options,userAnswer:ans,correct:q.correct,isCorrect:ok,explanation:q.explanation})});const total=state.quizQuestions.length,pct=Math.round(correct/total*100);state.score={correct:correct,total:total,pct:pct,results:results},document.getElementById("score-summary").innerHTML=`<div class="score-display">${correct}/${total}</div><div class="score-percent">${pct}%</div><div class="performance-msg">${getMsg(pct)}</div>`,document.getElementById("results-details").innerHTML=results.map((r,i)=>`<div class="result-item ${r.isCorrect?"correct":"incorrect"}"><h4>${r.isCorrect?"‚úÖ":"‚ùå"} Q${i+1}</h4><p>Q: ${r.question}</p><p>You: ${null!==r.userAnswer?r.options[r.userAnswer]:"N/A"}</p><p>‚úì: ${r.options[r.correct]}</p><p>Exp: ${r.explanation}</p></div>`).join(""),document.getElementById("certificate-btn").disabled=pct<70,showSection("results-section"),updateStep("results")}function getMsg(pct){return pct>=90?"üèÜ Exceptional!":pct>=80?"üéâ Excellent!":pct>=70?"‚úÖ Good!":pct>=60?"üëç Satisfactory":"üìö Study!"}function downloadResults(){if(!state.score)return;const{correct:c,total:t,pct:p,results:r}=state.score;let txt=`RESULTS\n${"=".repeat(40)}\nScore: ${c}/${t} (${p}%)\n\n${r.map((x,i)=>`Q${i+1}: ${x.question}\nYou: ${null!==x.userAnswer?x.options[x.userAnswer]:"N/A"}\nCorrect: ${x.options[x.correct]}\nExp: ${x.explanation}`).join("\n\n")}`;download(txt,"quiz-results.txt")}function downloadCertificate(){if(!state.score||state.score.pct<70)return void alert("Need 70%+");let cert=`\nüèÜ ACHIEVEMENT\n${"=".repeat(40)}\n\nScore: ${state.score.correct}/${state.score.total} (${state.score.pct}%)\nDate: ${new Date().toLocaleDateString()}\n\nüéâ Congratulations!`;download(cert,"certificate.txt")}function download(content,name){const blob=new Blob([content],{type:"text/plain"}),url=URL.createObjectURL(blob),a=document.createElement("a");a.href=url,a.download=name,a.click(),URL.revokeObjectURL(url)}function resetQuiz(){clearInterval(state.timerInterval),state.currentStep="upload",state.selectedDocument=null,state.questionCount=5,state.difficulty="medium",state.quizQuestions=[],state.currentQuestionIndex=0,state.answers=[],state.startTime=null,showSection("upload-section"),updateStep("upload")}function showSection(id){document.querySelectorAll(".section").forEach(s=>s.classList.add("hidden")),document.getElementById(id).classList.remove("hidden")}function updateStep(step){document.querySelectorAll(".step").forEach(s=>s.classList.remove("active")),document.querySelector(`[data-step="${step}"]`)?.classList.add("active"),state.currentStep=step}function setupTheme(){const btn=document.getElementById("theme-toggle");try{const saved=localStorage.getItem("theme")||"light";document.body.className=`theme-${saved}`,btn.textContent="dark"===saved?"‚òÄÔ∏è":"üåô",btn.addEventListener("click",()=>{const dark=document.body.classList.contains("theme-dark"),theme=dark?"light":"dark";document.body.className=`theme-${theme}`,btn.textContent="dark"===theme?"‚òÄÔ∏è":"üåô",localStorage.setItem("theme",theme)})}catch(e){console.log("localStorage unavailable")}}document.addEventListener("DOMContentLoaded",()=>{renderSamples(),setupFileUpload(),setupEventListeners(),setupTheme()}),window.selectDocument=selectDocument,window.selectAnswer=selectAnswer,window.prevQuestion=prevQuestion,window.nextQuestion=nextQuestion;
